<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gestione Inventario (Condiviso)</title>
  
  <!-- 1. Carica Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Stili CSS (invariati) */
    input[type='number']::-webkit-inner-spin-button,
    input[type='number']::-webkit-outer-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
    input[type='number'] {
      -moz-appearance: textfield;
    }
    /* Stile per un leggero feedback di caricamento */
    .loading-overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(255, 255, 255, 0.7);
      z-index: 999;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      color: #333;
    }
  </style>
</head>
<body class="bg-gray-100 min-h-screen p-4 md:p-8 font-sans">

  <!-- Overlay di caricamento iniziale -->
  <div id="loading-indicator" class="loading-overlay">
    <p>Caricamento dati...</p>
  </div>

  <div class="max-w-7xl mx-auto">
    
    <!-- Intestazione e Navigazione Viste (invariate) -->
    <header class="mb-6">
      <h1 class="text-3xl md:text-4xl font-bold text-gray-800 mb-4">Gestione Inventario e Ordini</h1>
      <nav class="flex space-x-2">
        <button id="nav-inventario"
          class="px-3 py-2 md:px-4 text-sm md:text-base rounded-lg font-semibold shadow-md transition-all duration-200 bg-blue-600 text-white">
          Inventario
        </button>
        <button id="nav-listaSpesa"
          class="px-3 py-2 md:px-4 text-sm md:text-base rounded-lg font-semibold shadow-md transition-all duration-200 bg-white text-gray-700">
          Lista Spesa
          <span id="shopping-list-badge" class="ml-2 bg-red-500 text-white text-xs font-bold rounded-full px-2 py-1 hidden">
          </span>
        </button>
      </nav>
    </header>

    <!-- Sezione Viste (HTML invariato) -->
    <main>
      <div id="view-inventario">
        <div class="space-y-6">
          
          <!-- Form Aggiungi Prodotto -->
          <div class="bg-white p-4 md:p-6 rounded-lg shadow-md">
            <h2 class="text-xl md:text-2xl font-semibold mb-4 text-gray-700">Aggiungi Nuovo Prodotto</h2>
            <form id="add-product-form" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
              <!-- Colonna 1 -->
              <div class="flex flex-col">
                <label class="mb-1 font-medium text-gray-600 text-sm">Nome Prodotto</label>
                <input type="text" name="nome" class="border rounded-md p-2 w-full shadow-sm" required>
              </div>
              <div class="flex flex-col">
                <label class="mb-1 font-medium text-gray-600 text-sm">Categoria</label>
                <input type="text" name="categoria" class="border rounded-md p-2 w-full shadow-sm" required>
              </div>
              <!-- Colonna 2 -->
              <div class="flex flex-col">
                <label class="mb-1 font-medium text-gray-600 text-sm">Fornitore</label>
                <input type="text" name="fornitore" class="border rounded-md p-2 w-full shadow-sm" required>
              </div>
              <div class="flex flex-col">
                <label class="mb-1 font-medium text-gray-600 text-sm">Prezzo (€)</label>
                <input type="number" name="prezzo" min="0" step="0.01" class="border rounded-md p-2 w-full shadow-sm" required>
              </div>
              <!-- Colonna 3 -->
              <div class="flex flex-col">
                <label class="mb-1 font-medium text-gray-600 text-sm">Q.tà Attuale</label>
                <input type="number" name="quantitaAttuale" min="0" step="1" class="border rounded-md p-2 w-full shadow-sm" required>
              </div>
              <div class="flex flex-col">
                <label class="mb-1 font-medium text-gray-600 text-sm">Q.tà Minima</label>
                <input type="number" name="quantitaMinima" min="0" step="1" class="border rounded-md p-2 w-full shadow-sm" required>
              </div>
              <!-- Colonna 4 -->
              <div class="flex flex-col">
                <label class="mb-1 font-medium text-gray-600 text-sm">Unità</label>
                <select name="unita" class="border rounded-md p-2 w-full bg-white shadow-sm" required>
                  <option value="kg">kg</option>
                  <option value="gr">gr</option>
                  <option value="pz" selected>pz</option>
                  <option value="ct">ct</option>
                </select>
              </div>
              
              <button type="submit" class="w-full md:col-span-2 lg:col-span-1 bg-blue-600 text-white rounded-md p-2.5 font-semibold shadow-md hover:bg-blue-700 transition-all duration-200 h-full self-end mt-2 md:mt-0">
                Aggiungi Prodotto
              </button>
            </form>
          </div>

          <!-- Filtri Vista Inventario (con aggiunta Vista Compatta/Completa) -->
          <div class="flex flex-wrap items-center justify-between gap-4">
            <div>
              <span class="font-medium text-gray-700">Raggruppa per:</span>
              <button id="group-categoria"
                class="px-3 py-1 rounded-md text-sm font-medium bg-blue-500 text-white">
                Categoria
              </button>
              <button id="group-fornitore"
                class="px-3 py-1 rounded-md text-sm font-medium bg-white shadow-sm">
                Fornitore
              </button>
            </div>
            
            <div class="border-l border-gray-300 pl-4">
              <span class="font-medium text-gray-700">Vista:</span>
              <button id="view-compatta"
                class="px-3 py-1 rounded-md text-sm font-medium bg-blue-500 text-white">
                Compatta
              </button>
              <button id="view-completa"
                class="px-3 py-1 rounded-md text-sm font-medium bg-white shadow-sm">
                Completa
              </button>
            </div>
          </div>

          <!-- Lista Prodotti Inventario -->
          <div id="inventory-list-container" class="space-y-6">
            <!-- Contenuto generato da JS -->
          </div>
        </div>
      </div>

      <!-- Vista Lista Spesa (HTML invariato) -->
      <div id="view-listaSpesa" class="hidden">
        <div class="bg-white p-4 md:p-6 rounded-lg shadow-md">
          <h2 class="text-2xl md:text-3xl font-bold text-gray-800 mb-6">Lista della Spesa</h2>
          <div id="shopping-list-container" class="space-y-8">
            <!-- Contenuto generato da JS -->
          </div>
        </div>
      </div>
    </main>

  </div>

  <!-- ================== NOVITÀ: SCRIPT FIREBASE ================== -->
  <!-- Carica le librerie di Firebase -->
  <script type="module">
    // Importa le funzioni di Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { 
      getFirestore, 
      collection, 
      doc, 
      addDoc, 
      deleteDoc, 
      updateDoc,
      onSnapshot 
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // --- Passaggio 1: Configurazione Firebase ---
    // INCOLLA QUI IL TUO OGGETTO `firebaseConfig` (preso dal Passaggio 1)
   const firebaseConfig = {
  apiKey: "AIzaSyDWS8urdhG9RdS62rihj0FBPV38aWUclGQ",
  authDomain: "inventario-a52a4.firebaseapp.com",
  projectId: "inventario-a52a4",
  storageBucket: "inventario-a52a4.firebasestorage.app",
  messagingSenderId: "531426475103",
  appId: "1:531426475103:web:9a3c9b74547fd19a0a6fea",
  measurementId: "G-8HSKSW2Q86"
};

    // --- Passaggio 2: ID Gruppo Condiviso ---
    // Inventa una stringa (come una password) e condividila con il tuo collega.
    // ENTRAMBI dovete avere LO STESSO ID qui.
    const GRUPPO_ID = "inventario-segreto-123";

    
    // --- Inizializzazione di Firebase ---
    let app, db, productsCollection;
    try {
      app = initializeApp(firebaseConfig);
      db = getFirestore(app);
      // Questo crea un percorso unico per il tuo gruppo: inventari/inventario-segreto-123/prodotti
      productsCollection = collection(db, "inventari", GRUPPO_ID, "prodotti");
    } catch (e) {
      console.error("Errore configurazione Firebase:", e);
      alert("Errore nella configurazione di Firebase! Hai incollato correttamente la config?");
    }

    // --- STATO LOCALE (non salvato) ---
    const state = {
      currentView: 'inventario',
      groupBy: 'categoria',
      inventoryViewMode: 'compatta',
      products: [] // Questo ora è un cache locale, il "master" è su Firestore
    };
    
    const unitOptions = ['kg', 'gr', 'pz', 'ct'];

    // --- SELETTORI DOM (invariati) ---
    const $ = (selector) => document.querySelector(selector);
    const viewInventario = $('#view-inventario');
    const viewListaSpesa = $('#view-listaSpesa');
    const navInventario = $('#nav-inventario');
    const navListaSpesa = $('#nav-listaSpesa');
    const groupCategoria = $('#group-categoria');
    const groupFornitore = $('#group-fornitore');
    const viewCompatta = $('#view-compatta');
    const viewCompleta = $('#view-completa');
    const addProductForm = $('#add-product-form');
    const inventoryListContainer = $('#inventory-list-container');
    const shoppingListContainer = $('#shopping-list-container');
    const shoppingListBadge = $('#shopping-list-badge');
    const loadingIndicator = $('#loading-indicator');

    // --- FUNZIONI DI LOGICA (Aggiornate per Firebase) ---

    /** Carica i prodotti da Firestore e resta in ascolto */
    function loadProducts() {
      if (!productsCollection) return;

      // onSnapshot è la magia: si attiva una volta al caricamento
      // e poi OGNI VOLTA che i dati cambiano sul server.
      onSnapshot(productsCollection, (snapshot) => {
        state.products = []; // Svuota la cache locale
        snapshot.forEach((doc) => {
          state.products.push({ id: doc.id, ...doc.data() });
        });
        
        // Dati caricati, nascondi l'indicatore e fai il primo render
        loadingIndicator.classList.add('hidden');
        render(); 
        
      }, (error) => {
        console.error("Errore nel caricare i prodotti: ", error);
        alert("Errore nel caricare i dati. Controlla le regole di sicurezza di Firestore.");
      });
    }

    /** Raggruppa i prodotti (invariato) */
    function getGroupedProducts() {
      const groupKey = state.groupBy;
      const grouped = state.products.reduce((acc, prodotto) => {
        const key = prodotto[groupKey] || 'Non Assegnato';
        if (!acc.has(key)) {
          acc.set(key, []);
        }
        acc.get(key).push(prodotto);
        return acc;
      }, new Map());
      
      return new Map([...grouped.entries()].sort((a, b) => a[0].localeCompare(b[0])));
    }

    /** Filtra e raggruppa lista spesa (invariato) */
    function getShoppingListGrouped() {
      const prodottiDaAcquistare = state.products.filter(
        p => p.quantitaAttuale <= p.quantitaMinima
      );
      const grouped = prodottiDaAcquistare.reduce((acc, prodotto) => {
        const key = prodotto.fornitore || 'Sconosciuto';
        if (!acc.has(key)) {
          acc.set(key, []);
        }
        acc.get(key).push(prodotto);
        return acc;
      }, new Map());
      
      return new Map([...grouped.entries()].sort((a, b) => a[0].localeCompare(b[0])));
    }

    /** Aggiunge un nuovo prodotto a Firestore */
    async function aggiungiProdotto(e) {
      e.preventDefault();
      const formData = new FormData(e.target);
      const newProduct = {}; // NON serve più l'ID, lo crea Firebase
      
      for (let [key, value] of formData.entries()) {
        if (key === 'prezzo' || key === 'quantitaAttuale' || key === 'quantitaMinima') {
          newProduct[key] = parseFloat(value) || 0;
        } else {
          newProduct[key] = value;
        }
      }
      
      try {
        await addDoc(productsCollection, newProduct);
        // Non serve chiamare render(), onSnapshot lo farà automaticamente!
        e.target.reset();
      } catch (e) {
        console.error("Errore aggiungendo prodotto: ", e);
      }
    }

    /** Rimuove un prodotto da Firestore */
    async function rimuoviProdotto(id) {
      try {
        await deleteDoc(doc(db, "inventari", GRUPPO_ID, "prodotti", id));
        // Non serve chiamare render(), onSnapshot lo farà automaticamente!
      } catch (e) {
        console.error("Errore rimuovendo prodotto: ", e);
      }
    }

    /** Aggiorna un campo del prodotto su Firestore */
    async function updateProductField(id, field, value) {
      const productRef = doc(db, "inventari", GRUPPO_ID, "prodotti", id);
      let updateData = {};
      
      if (field === 'prezzo' || field === 'quantitaAttuale' || field === 'quantitaMinima') {
        updateData[field] = parseFloat(value) || 0;
      } else {
        updateData[field] = value;
      }

      try {
        await updateDoc(productRef, updateData);
        // Non serve chiamare render(), onSnapshot lo farà automaticamente!
      } catch (e) {
        console.error("Errore aggiornando prodotto: ", e);
      }
    }

    // --- FUNZIONI DI RENDER (Tutte invariate) ---

    function render() {
      renderNav();
      renderViews();
      renderInventoryList();
      renderShoppingList();
      renderBadge();
    }

    function renderNav() {
      if (state.currentView === 'inventario') {
        navInventario.classList.add('bg-blue-600', 'text-white');
        navInventario.classList.remove('bg-white', 'text-gray-700');
        navListaSpesa.classList.add('bg-white', 'text-gray-700');
        navListaSpesa.classList.remove('bg-blue-600', 'text-white');
      } else {
        navListaSpesa.classList.add('bg-blue-600', 'text-white');
        navListaSpesa.classList.remove('bg-white', 'text-gray-700');
        navInventario.classList.add('bg-white', 'text-gray-700');
        navInventario.classList.remove('bg-blue-600', 'text-white');
      }
      
      if (state.groupBy === 'categoria') {
        groupCategoria.classList.add('bg-blue-500', 'text-white');
        groupCategoria.classList.remove('bg-white', 'shadow-sm');
        groupFornitore.classList.add('bg-white', 'shadow-sm');
        groupFornitore.classList.remove('bg-blue-500', 'text-white');
      } else {
        groupFornitore.classList.add('bg-blue-500', 'text-white');
        groupFornitore.classList.remove('bg-white', 'shadow-sm');
        groupCategoria.classList.add('bg-white', 'shadow-sm');
        groupCategoria.classList.remove('bg-blue-500', 'text-white');
      }
      
      if (state.inventoryViewMode === 'compatta') {
        viewCompatta.classList.add('bg-blue-500', 'text-white');
        viewCompatta.classList.remove('bg-white', 'shadow-sm');
        viewCompleta.classList.add('bg-white', 'shadow-sm');
        viewCompleta.classList.remove('bg-blue-500', 'text-white');
      } else {
        viewCompleta.classList.add('bg-blue-500', 'text-white');
        viewCompleta.classList.remove('bg-white', 'shadow-sm');
        viewCompatta.classList.add('bg-white', 'shadow-sm');
        viewCompatta.classList.remove('bg-blue-500', 'text-white');
      }
    }

    function renderViews() {
      viewInventario.classList.toggle('hidden', state.currentView !== 'inventario');
      viewListaSpesa.classList.toggle('hidden', state.currentView !== 'listaSpesa');
    }

    function getUnitOptionsHTML(selectedValue) {
      return unitOptions.map(unita => 
        `<option value="${unita}" ${unita === selectedValue ? 'selected' : ''}>${unita}</option>`
      ).join('');
    }

    function renderInventoryList() {
      const grouped = getGroupedProducts();
      if (state.products.length === 0) {
        inventoryListContainer.innerHTML = `<div class="bg-white p-6 rounded-lg shadow text-center text-gray-500">
          Nessun prodotto nell'inventario. Inizia aggiungendone uno!
        </div>`;
        return;
      }
      
      let html = '';
      for (let [groupKey, prodotti] of grouped) {
        html += `<section>
          <h2 class="text-xl md:text-2xl font-bold text-gray-700 mt-6 mb-3 border-b-2 border-gray-300 pb-2 capitalize">
            ${groupKey}
          </h2>
          <div class="grid grid-cols-1 ${state.inventoryViewMode === 'completa' ? 'xl:grid-cols-2' : ''} gap-4">
            ${prodotti.map(prodotto => {
              const borderClass = prodotto.quantitaAttuale <= prodotto.quantitaMinima ? 'border-l-4 border-red-500' : 'border-transparent';
              const qtyClass = prodotto.quantitaAttuale <= prodotto.quantitaMinima ? 'text-red-600' : 'text-green-600';
              
              const cardTop = `
                <div class="flex justify-between items-start mb-3">
                  <input type="text" value="${prodotto.nome}" data-id="${prodotto.id}" data-field="nome"
                    class="editable-input text-lg md:text-xl font-bold text-blue-800 border-b-2 border-transparent focus:border-blue-300 outline-none w-2/3">
                  <button class="remove-btn text-red-500 hover:text-red-700 font-semibold transition-colors text-sm flex-shrink-0 ml-2" data-id="${prodotto.id}">
                    Rimuovi
                  </button>
                </div>`;
                
              let cardBottom = '';
              
              if (state.inventoryViewMode === 'compatta') {
                cardBottom = `
                  <div class="flex flex-wrap items-center gap-x-4 gap-y-2 mt-2 text-sm text-gray-600">
                    <div class="flex items-center space-x-2">
                      <label class="text-xs font-semibold text-gray-500">Q.tà:</label>
                      <input type="number" value="${prodotto.quantitaAttuale}" data-id="${prodotto.id}" data-field="quantitaAttuale"
                        class="editable-input w-20 border rounded-md p-1 text-center font-medium ${qtyClass}">
                    </div>
                    <div class="flex items-center space-x-1">
                       <label class="text-xs font-semibold text-gray-500">Unità:</label>
                       <span class="font-medium">${prodotto.unita}</span>
                    </div>
                    <div class="flex items-center space-x-1">
                      <label class="text-xs font-semibold text-gray-500">Min:</label>
                      <span class="font-medium">${prodotto.quantitaMinima}</span>
                    </div>
                  </div>`;
              } else {
                cardBottom = `
                  <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-x-4 gap-y-3 text-sm text-gray-600">
                    <div class="flex flex-col">
                      <label class="text-xs font-semibold text-gray-500">Categoria</label>
                      <input type="text" value="${prodotto.categoria}" data-id="${prodotto.id}" data-field="categoria"
                        class="editable-input border-b border-transparent focus:border-gray-300 outline-none w-full">
                    </div>
                    <div class="flex flex-col">
                      <label class="text-xs font-semibold text-gray-500">Fornitore</label>
                      <input type="text" value="${prodotto.fornitore}" data-id="${prodotto.id}" data-field="fornitore"
                        class="editable-input border-b border-transparent focus:border-gray-300 outline-none w-full">
                    </div>
                    <div class="flex flex-col">
                      <label class="text-xs font-semibold text-gray-500">Prezzo</label>
                      <div class="flex items-center">
                        <span class="mr-1">€</span>
                        <input type="number" value="${prodotto.prezzo}" data-id="${prodotto.id}" data-field="prezzo"
                          class="editable-input w-20 border-b border-transparent focus:border-gray-300 outline-none">
                      </div>
                    </div>
                    <div class="flex flex-col">
                      <label class="text-xs font-semibold text-gray-500">Q.tà Attuale</label>
                      <input type="number" value="${prodotto.quantitaAttuale}" data-id="${prodotto.id}" data-field="quantitaAttuale"
                        class="editable-input w-16 border-b border-transparent focus:border-gray-300 outline-none font-medium ${qtyClass}">
                    </div>
                    <div class="flex flex-col">
                      <label class="text-xs font-semibold text-gray-500">Q.tà Minima</label>
                      <input type="number" value="${prodotto.quantitaMinima}" data-id="${prodotto.id}" data-field="quantitaMinima"
                        class="editable-input w-16 border-b border-transparent focus:border-gray-300 outline-none">
                    </div>
                    <div class="flex flex-col">
                      <label class="text-xs font-semibold text-gray-500">Unità</label>
                      <select data-id="${prodotto.id}" data-field="unita"
                        class="editable-input w-20 border-b bg-white border-transparent focus:border-gray-300 outline-none">
                        ${getUnitOptionsHTML(prodotto.unita)}
                      </select>
                    </div>
                  </div>`;
              }
              
              return `<div class="bg-white shadow-lg rounded-lg p-4 transition-all duration-300 ${borderClass}">
                ${cardTop}
                ${cardBottom}
              </div>`;
              
            }).join('')}
          </div>
        </section>`;
      }
      inventoryListContainer.innerHTML = html;
    }

    function renderShoppingList() {
      const grouped = getShoppingListGrouped();
      if (grouped.size === 0) {
        shoppingListContainer.innerHTML = `<div class="text-center text-gray-500 py-10">
          <p class="text-lg">La tua lista della spesa è vuota!</p>
          <p class="text-sm md:text-base">I prodotti appariranno qui automaticamente quando la loro quantità scende sotto il minimo.</p>
        </div>`;
        return;
      }
      
      let html = '';
      for (let [groupKey, prodotti] of grouped) {
        html += `<section>
          <h3 class="text-xl md:text-2xl font-semibold text-blue-700 mb-3 border-b border-blue-200 pb-2">
            Fornitore: <span class="font-bold">${groupKey}</span>
          </h3>
          <ul class="list-disc list-inside pl-2 md:pl-4 space-y-2">
            ${prodotti.map(prodotto => `
              <li class="text-gray-800 text-base md:text-lg">
                <span class="font-semibold">${prodotto.nome}</span>
                <span class="block text-sm text-gray-600 ml-6 md:ml-2 md:inline">
                  (Attuale: <strong class="text-red-600">${prodotto.quantitaAttuale}</strong> / Min: ${prodotto.quantitaMinima}) - ${prodotto.unita}
                </span>
              </li>
            `).join('')}
          </ul>
        </section>`;
      }
      shoppingListContainer.innerHTML = html;
    }
    
    function renderBadge() {
        const grouped = getShoppingListGrouped();
        const totalItems = Array.from(grouped.values()).reduce((acc, prodotti) => acc + prodotti.length, 0);
        
        if (totalItems > 0) {
            shoppingListBadge.textContent = totalItems;
            shoppingListBadge.classList.remove('hidden');
        } else {
            shoppingListBadge.classList.add('hidden');
        }
    }

    // --- EVENT LISTENERS (invariati) ---

    navInventario.addEventListener('click', () => {
      state.currentView = 'inventario';
      renderNav();
      renderViews();
    });
    navListaSpesa.addEventListener('click', () => {
      state.currentView = 'listaSpesa';
      renderNav();
      renderViews();
    });

    groupCategoria.addEventListener('click', () => {
      state.groupBy = 'categoria';
      renderNav(); // Aggiorna i pulsanti
      renderInventoryList(); // Rirenderizza solo la lista
    });
    groupFornitore.addEventListener('click', () => {
      state.groupBy = 'fornitore';
      renderNav(); // Aggiorna i pulsanti
      renderInventoryList(); // Rirenderizza solo la lista
    });

    viewCompatta.addEventListener('click', () => {
      state.inventoryViewMode = 'compatta';
      renderNav(); // Aggiorna i pulsanti
      renderInventoryList(); // Rirenderizza solo la lista
    });
    viewCompleta.addEventListener('click', () => {
      state.inventoryViewMode = 'completa';
      renderNav(); // Aggiorna i pulsanti
      renderInventoryList(); // Rirenderizza solo la lista
    });

    addProductForm.addEventListener('submit', aggiungiProdotto);

    document.body.addEventListener('click', (e) => {
      const removeButton = e.target.closest('.remove-btn');
      if (removeButton) {
        const id = removeButton.dataset.id;
        // Chiedi conferma prima di eliminare
        if (confirm("Sei sicuro di voler eliminare questo prodotto?")) {
          rimuoviProdotto(id);
        }
      }
    });
    
    document.body.addEventListener('change', (e) => {
        if (e.target.classList.contains('editable-input')) {
            const { id, field } = e.target.dataset;
            // Un piccolo timeout per evitare aggiornamenti troppo rapidi se l'utente
            // sta ancora digitando. In un'app reale si userebbe un "debounce" più avanzato.
            setTimeout(() => {
                if (e.target === document.activeElement) return; // Non aggiornare se l'utente sta ancora scrivendo
            }, 500);
            updateProductField(id, field, e.target.value);
        }
    });
     
    // Gestisce il focus-out per salvare subito
    document.body.addEventListener('focusout', (e) => {
        if (e.target.classList.contains('editable-input')) {
            const { id, field } = e.target.dataset;
            updateProductField(id, field, e.target.value);
        }
    });


    // --- INIZIALIZZAZIONE ---
    // Avvia l'ascolto dei dati da Firebase
    loadProducts();

  </script>
</body>
</html>

